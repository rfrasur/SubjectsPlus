<?php
require_once __DIR__ . '/../../vendor/autoload.php';
require_once __DIR__ . '/../../lib/LTI13/SP_Database.php';

use \IMSGlobal\LTI;
use Firebase\JWT\JWT;
use Firebase\JWT\Key;


//$launch = LTI\LTI_Message_Launch::new(new SP_Database())
//                                ->validate();

//var_dump($_REQUEST['id_token']);

//LTI\JWKS_Endpoint::new([
//    'e6a14d56-4190-4a3b-b3da-7d728808f163' => file_get_contents(__DIR__ . '/jwtRS256.key')
//])->output_jwks();

//$jwt = $_REQUEST['id_token'];
$jwt = "eyJraWQiOiJlNmExNGQ1Ni00MTkwLTRhM2ItYjNkYS03ZDcyODgwOGYxNjMiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI3ZmIwMTdmNmJlMTI0ZWI1ODg4ZTk3ZTUzYWI3ZjQwMiIsImh0dHBzOlwvXC9wdXJsLmltc2dsb2JhbC5vcmdcL3NwZWNcL2x0aVwvY2xhaW1cL2RlcGxveW1lbnRfaWQiOiI2ZTc3OWQ4Mi1jZTFmLTQ2MjMtYTU0NC1jNmNkNTczZDUxZjIiLCJodHRwczpcL1wvcHVybC5pbXNnbG9iYWwub3JnXC9zcGVjXC9sdGlcL2NsYWltXC92ZXJzaW9uIjoiMS4zLjAiLCJpc3MiOiJodHRwczpcL1wvYmxhY2tib2FyZC5jb20iLCJnaXZlbl9uYW1lIjoiQ2hhcmxlcyBHbGVuIiwibG9jYWxlIjoiZW4tVVMiLCJodHRwczpcL1wvcHVybC5pbXNnbG9iYWwub3JnXC9zcGVjXC9sdGlcL2NsYWltXC9yb2xlcyI6WyJodHRwOlwvXC9wdXJsLmltc2dsb2JhbC5vcmdcL3ZvY2FiXC9saXNcL3YyXC9tZW1iZXJzaGlwI0luc3RydWN0b3IiLCJodHRwOlwvXC9wdXJsLmltc2dsb2JhbC5vcmdcL3ZvY2FiXC9saXNcL3YyXC9zeXN0ZW1cL3BlcnNvbiNBZG1pbmlzdHJhdG9yIiwiaHR0cDpcL1wvcHVybC5pbXNnbG9iYWwub3JnXC92b2NhYlwvbGlzXC92MlwvbWVtYmVyc2hpcCNBZG1pbmlzdHJhdG9yIiwiaHR0cDpcL1wvcHVybC5pbXNnbG9iYWwub3JnXC92b2NhYlwvbGlzXC92MlwvaW5zdGl0dXRpb25cL3BlcnNvbiNTdGFmZiJdLCJub25jZSI6Im5vbmNlLTY0Mjc0ZDhmYzdjMmEyLjgxNTk5MDE2IiwiaHR0cHM6XC9cL3B1cmwuaW1zZ2xvYmFsLm9yZ1wvc3BlY1wvbHRpXC9jbGFpbVwvdG9vbF9wbGF0Zm9ybSI6eyJuYW1lIjoiQmxhY2tib2FyZCwgSW5jLiIsImRlc2NyaXB0aW9uIjoiQmxhY2tib2FyZCwgSW5jLiIsImd1aWQiOiI5MGUzYzFjMTE5N2Y0YTliYmQ0MTc3N2MzMTBmNjMxZCIsInByb2R1Y3RfZmFtaWx5X2NvZGUiOiJCbGFja2JvYXJkTGVhcm4iLCJ2ZXJzaW9uIjoiMzkwMC42Mi4wLXJlbC4xOCtmZjY2MDc0IiwidXJsIjoiaHR0cHM6XC9cL21pYW1pLXRlc3QuYmxhY2tib2FyZC5jb21cLyIsImNvbnRhY3RfZW1haWwiOiJhZG1pbkBtaWFtaS10ZXN0LmJsYWNrYm9hcmQuY29tIn0sImh0dHBzOlwvXC9wdXJsLmltc2dsb2JhbC5vcmdcL3NwZWNcL2x0aVwvY2xhaW1cL3RhcmdldF9saW5rX3VyaSI6Imh0dHBzOlwvXC9kZXYtZS1zdWJqZWN0c3BsdXMuYXp1cmV3ZWJzaXRlcy5uZXRcL2FkZG9uc1wvYmItbHRpXC9sdGkucGhwIiwiaHR0cHM6XC9cL3B1cmwuaW1zZ2xvYmFsLm9yZ1wvc3BlY1wvbHRpXC9jbGFpbVwvY29udGV4dCI6eyJpZCI6ImZmNzVlMzhjNzI5YTRkNmZiNmI2ZTU4YjQ2NDgxZGI4IiwibGFiZWwiOiJISVM1MzYtNDMtMTExMDEtMS0yMDIzMSIsInRpdGxlIjoiMjAyMzEgLSBISVM1MzZcLzYzNi00MyAtIE1FUkdFRCAtIFN0dWRpZXMgaW4gTWVkaWV2YWwgSGlzdG9yeSAoU3ByaW5nIDIwMjMpIiwidHlwZSI6WyJodHRwOlwvXC9wdXJsLmltc2dsb2JhbC5vcmdcL3ZvY2FiXC9saXNcL3YyXC9jb3Vyc2UjQ291cnNlT2ZmZXJpbmciXX0sImh0dHBzOlwvXC9wdXJsLmltc2dsb2JhbC5vcmdcL3NwZWNcL2x0aVwvY2xhaW1cL3Jlc291cmNlX2xpbmsiOnsiaWQiOiJfNjZfMVN1YmplY3RQbHVzVGVzdCJ9LCJodHRwczpcL1wvcHVybC5pbXNnbG9iYWwub3JnXC9zcGVjXC9sdGlcL2NsYWltXC9jdXN0b20iOnsiY291cnNlX2lkIjoiXC9jb3Vyc2VzXC8xXC9ISVM1MzYtNDMtMTExMDEtMS0yMDIzMVwvIiwiYmxhY2tib2FyZF9jb3Vyc2VfaWQiOiJfNjZfMSIsImNhbGlwZXJfcHJvZmlsZV91cmwiOiJodHRwczpcL1wvbWlhbWktdGVzdC5ibGFja2JvYXJkLmNvbVwvbGVhcm5cL2FwaVwvdjFcL3RlbGVtZXRyeVwvY2FsaXBlclwvcHJvZmlsZSIsImNvdXJzZV9uYW1lIjoiMjAyMzEgLSBISVM1MzZcLzYzNi00MyAtIE1FUkdFRCAtIFN0dWRpZXMgaW4gTWVkaWV2YWwgSGlzdG9yeSAoU3ByaW5nIDIwMjMpIiwiY2FsaXBlcl9mZWRlcmF0ZWRfc2Vzc2lvbl9pZCI6Imh0dHBzOlwvXC9jYWxpcGVyLW1hcHBpbmcuY2xvdWRiYi5ibGFja2JvYXJkLmNvbVwvdjFcL3NpdGVzXC9iZTFjNzc1MS1lYmE3LTQwNjgtYjVjZC1iMDk3MDc1M2MwMThcL3Nlc3Npb25zXC8wMjJEQzU4Q0VFOUU1N0VFQkM5NkI1MUQzMUFFREY3MSIsInVzZXJfZnVsbF9uYW1lIjoiQ2hhcmxlcyBHbGVuIEJyb3duLVJvYmVydHMiLCJjb3Vyc2VfdXJsIjoiXC9jb3Vyc2VzXC8xXC9ISVM1MzYtNDMtMTExMDEtMS0yMDIzMVwvIiwiY29udGVudF91cmwiOiJAWEBjb250ZW50LnVybEBYQCIsImxhYmVsIjoiSElTNTM2LTQzLTExMTAxLTEtMjAyMzEiLCJ0aXRsZSI6IjIwMjMxIC0gSElTNTM2XC82MzYtNDMgLSBNRVJHRUQgLSBTdHVkaWVzIGluIE1lZGlldmFsIEhpc3RvcnkgKFNwcmluZyAyMDIzKSIsInByaW1hcnlfa2V5IjoiXzY2XzEifSwiYXVkIjoiMDhjYWJhYmMtYzE0MC00OTJhLTk5YzEtMWJhYTVhNTI0MGRkIiwiaHR0cHM6XC9cL3B1cmwuaW1zZ2xvYmFsLm9yZ1wvc3BlY1wvbHRpXC9jbGFpbVwvbWVzc2FnZV90eXBlIjoiTHRpUmVzb3VyY2VMaW5rUmVxdWVzdCIsIm5hbWUiOiJDaGFybGVzIEdsZW4gQnJvd24tUm9iZXJ0cyIsImh0dHBzOlwvXC9wdXJsLmltc2dsb2JhbC5vcmdcL3NwZWNcL2x0aVwvY2xhaW1cL2xpcyI6eyJwZXJzb25fc291cmNlZGlkIjoiY2dicm9iZXJ0cyIsImNvdXJzZV9zZWN0aW9uX3NvdXJjZWRpZCI6IkhJUzUzNi00My0xMTEwMS0xLTIwMjMxIn0sImh0dHBzOlwvXC9wdXJsLmltc2dsb2JhbC5vcmdcL3NwZWNcL2x0aVwvY2xhaW1cL2xhdW5jaF9wcmVzZW50YXRpb24iOnsiZG9jdW1lbnRfdGFyZ2V0Ijoid2luZG93IiwicmV0dXJuX3VybCI6Imh0dHBzOlwvXC9taWFtaS10ZXN0LmJsYWNrYm9hcmQuY29tXC93ZWJhcHBzXC9ibGFja2JvYXJkXC9leGVjdXRlXC9ibHRpXC9sYXVuY2hSZXR1cm4_Y291cnNlX2lkPV82Nl8xJm5vbmNlPTk0ZDQ2NjIyOGE5ODQwMzhhMmI2OTc4NGRiNWE5YWRjJmxhdW5jaF9pZD05YTcxNGRlNC1hOWMzLTRjMzktYmExNy1lZGI3OTBhOTczZTMmbGlua19pZD1fNjZfMVN1YmplY3RQbHVzVGVzdCZsYXVuY2hfdGltZT0xNjgwMjk3MzYwMDkwIiwibG9jYWxlIjoiZW4tVVMifSwiZXhwIjoxNjgwMzAwOTYwLCJpYXQiOjE2ODAyOTczNjAsImZhbWlseV9uYW1lIjoiQnJvd24tUm9iZXJ0cyIsImh0dHBzOlwvXC9ibGFja2JvYXJkLmNvbVwvbHRpXC9jbGFpbVwvb25lX3RpbWVfc2Vzc2lvbl90b2tlbiI6ImY0MDZkOTVlYjM0ZDQ4N2Y5MTc1MTgwMmVlZDA1NzU2IiwiaHR0cHM6XC9cL2JsYWNrYm9hcmQuY29tXC93ZWJhcHBzXC9mb3VuZGF0aW9ucy1jb25uZWN0b3JcL2ZvdW5kYXRpb25zLWlkcyI6eyJjb3Vyc2UtaWQiOiIyN2E0NDIyOC1jOWEwLTExZWQtOWNjNC1kNTk3NjQ4MjIzMmQiLCJ1c2VyLWlkIjoiNDhkNTg0NTYtOWJmNy0xMWVkLWJhOGQtNTlkMDYyOGE0NmFjIiwic2l0ZS1pZCI6ImJlMWM3NzUxLWViYTctNDA2OC1iNWNkLWIwOTcwNzUzYzAxOCIsInJlZ2lvbiI6InVzLWVhc3QtMSIsInRlbmFudC1pZCI6Ijg0MjExY2YwLTg5ZDYtNGJiZi1hOTlhLWM2MTI2MjhlMjk3NyJ9fQ.Z6l9yBzYFPCNTizBltv9p951iMHiIhB-3a-21jm5KoBrYcog6AcFg5Ef7kz3uPvy0hA_FpDTPnSJkLFNrCs2XZtVKtYVQqVa4rgD57xrxn9-JtsNYeMZ2skYYYLJPDCwUi5Rm90xrnJrsHBgO6sGSB9NGy92Uv09yQwcp05dQNgTnSO_-t1BSShbQS7w42lJtlMon4U-GgvhrbR9z1l2DaqQ2XDZArFTb2rxTMlSjiiIqm5o_0T3aQ90t2Aagd7_0WmzL5fVqYKP7G3pcbOElsecm1AkjelDYufHsOHjKjeXlCKbCO_20X_DaCUAOoHy-OHaOBwQtOw-I3bFr8HVig";

//$decoded = JWT::decode($jwt, new Key("e6a14d56-4190-4a3b-b3da-7d728808f163", 'RS256'));
//
///*
// NOTE: This will now be an object instead of an associative array. To get
// an associative array, you will need to cast it as such:
//*/
//
//$decoded_array = (array) $decoded;
//echo "Decode:\n" . print_r($decoded_array, true) . "\n";

//$jwt = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJleGFtcGxlLm9yZyIsImF1ZCI6ImV4YW1wbGUuY29tIiwiaWF0IjoxMzU2OTk5NTI0LCJuYmYiOjEzNTcwMDAwMDB9.gfwYobaRf8uxn7p5-o9-gyNhABjUVzksanUnqSL74Fx8yCAwL5JSD7HofbXUvx2MqM0BMbrXyOGnRbxBaM7pv8NvsCkyyPMRMW3ZJkAyr-RT0QMrikRkfcS1N5ysx4y5iy5YUt-sM0yFsZ8DJaVdxA8eYNidxGm-fbp_XmL8nvLdodJIRrVzXBb3Os5J8jxdfSsNkWTMIO9eXWpD8hW1Rory7RBhvFodV1PKIQUSOVuAbYAUXndVwG2YSmv8_NPRxIM8PAyRwwKlKUYLbJYgcBhPDahlZz7go2hBBNhjmPRQIH28qs7cpxJyt9Nsq-UB0S6pnkwfUVmWwBN8Q9v74FNFD3rdX_hdHl50mlgwa7b49oXA3Vz7qDQRTlK08do0HqEr2pODbe2GJvV3lgs47c_IIP_2i7Mcu0lnEu4qmoaHPvXbZ91aJlRti8If3CN8rSkXr0yUbQOEQUeu84ZoE4J677wa561f2IxYsbttnA2yEKc7WGhebE1sNCpLSY-IE-AemT0ScPxtnBt6yY7hpHlgUCW5aQwEeYiOQ5L7ox_HsY9nHk_OPsB5muncO8P7oxDsR2aIT_ZA-4aZgx5pwD_UazYlfF48rJ7FRMLSyJiBlOS5p-Xr9piEnFtTIJYuAl-8v7Io6-B5Aq8dJSdnVfofK-hPkICwsx5yf1NUppk";

$privateKey = <<<EOD
-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
EOD;

$publicKey = <<<EOD
-----BEGIN PUBLIC KEY-----
MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA1BGXBwHlhgktuAovvI13
hY6nXK0mWrS854PGWCO9cnQOYLh2YSWhYwMdrf9H/G4G7bpnElO5+/fhEdMv8b/s
5MD0vGaMIJZO6pBspM3DNvPxJnzcx+A2uXC8t8oq7weJLh+DOcuIyXkUUprj08Cy
LPS0CKrWWvXwGkyuIgNL3P61Ub6fAEFRebFgqfe7XqRErBz3ui8EHGcl/ERvj0l7
v+3MtsamcMaX+jJnSBnk/8gxFvshmVdILweGuo2iPqM3Zltc2aegHzHMJ0A7d57C
nXmZNWja01+3p7SKvBZlsnEnJ7Mu/nknyjEviDvkfQkNd2IuU7KKDSi0PyO+ugqO
Ot25fCB1tBiaLME6kBqK0vroVusMdjBa+Sz7gKQSdx0UD6sSCpirl1w8toNU8KXZ
pnhVbxbdSybCYsXBkxIM3P20VRYgXOioKf3zaLQLlngaS4YUUW73HFMD5v/Oycv9
FwLVhlHtUndDFIdBovyDdFUbYl+kvn6QpvgipZO9Vg19wFjU2628orKAbIkia93l
ta8fkTqKR+FUwHjfB/KEt8JUfb/IdWcZHTqgkRLzoMp9kBa7PBekkmrBn9MMrIKz
HAKygtVmC+T+y7Lg7Eim+Kh+2O/2rpnRUN4i9+qj36XhxoqCQSyyjTDBYmyJJ25a
9Nz1zu8tUYjxxBh9weoTBSMCAwEAAQ==
-----END PUBLIC KEY-----
EOD;
//
//$payload = [
//    'iss' => 'example.org',
//    'aud' => 'example.com',
//    'iat' => 1356999524,
//    'nbf' => 1357000000
//];
//
//$jwt = JWT::encode($payload, $privateKey, 'RS256');
//echo "Encode:\n" . print_r($jwt, true) . "\n";

$decoded = JWT::decode($jwt, new Key($publicKey, 'RS256'));

/*
 NOTE: This will now be an object instead of an associative array. To get
 an associative array, you will need to cast it as such:
*/

$decoded_array = (array) $decoded;
echo "Decode:\n" . print_r($decoded_array, true) . "\n";

die();

try {
    require_once __DIR__ . '/../../control/includes/config.php';

    global $lti_enabled;
    global $PublicPath;
    $guide_path = $PublicPath;

    require_once __DIR__ . '/../../control/includes/functions.php';
    require_once __DIR__ . '/../../control/lti_controller/LTICourseController.php';

    // TODO: require course_id instead of context_label
    if (isset($lti_enabled) && $lti_enabled) {
        $course_label = scrubData($_REQUEST["context_label"]);
        $courses_code = new LTICourseController('bb_course_code', 'bb_course_instructor');
        $courses_code->processCourseCode($course_label, $guide_path);

    } else {
        header("Location: " . $guide_path . "?invalid_lti_call=1"); /* Redirect browser */
    }

} catch (Exception $e) {
    echo 'Exception "\n"', $e->getMessage(), "\n";
    exit();
}
